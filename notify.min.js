/*!
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *  SOFTWARE.
 *
 * Date: 09/08/2015
 * @version 1.01
 * @author Angel Zaprianov <me@fire1.eu>
 * Homepage: https://github.com/fire1/Notify
 */
(function(a){a.notify=function(l){var b=a.extend({url:"",timer:3000,query:{},icon:"notify.png",dataIndex:"",dataGlobal:"global",data:[],debug:false},l);var c=function(m){if(b.debug){console.log(m)}};var e=function(m,n){return localStorage.setItem(m,JSON.stringify(n))};var g=function(m){return JSON.parse(localStorage.getItem(m))};var i=g("notifyTime");if(!i){i=[]}var k=function(n){if(!n.name||!n.body){console.error('Given file is not supported! Please set your json as {name: "", body:"", time:"" }');return}c(Math.floor(Date.now()/1000));var m=parseInt(n.time);if(Math.floor(Date.now()/1000)<m){return}if(i.indexOf(m)==-1){i.push(m);d(n.name,n.body,!n.icon?b.icon:n.icon);e("notifyTime",i)}};var j=function(o,m,n){return new Notification(o,{body:m,icon:n})};var d=function(o,m,n){if(!("Notification" in window)){alert(m);console.error("Browser do not support notification!")}else{if(Notification.permission==="granted"){j(o,m,n)}else{if(Notification.permission!=="denied"){Notification.requestPermission(function(p){if(p==="granted"){j(o,m,n)}})}}}};var f=function(){a.each(b.data,function(m,n){k(n)});setTimeout(f,b.timer)};var h=function(){var m=a.ajax({url:b.url,data:b.query,dataType:"json"});m.done(function(n){if(b.dataIndex){var o=n[b.dataGlobal];n=n[b.dataIndex];a.extend(n,o)}a.each(n,function(p,q){c("Logging message into notify",p,q);k(q)})});m.fail(function(n,o){console.error("Cannot find given URL page: "+b.url)});setTimeout(h,b.timer)};if(b.url){c("Using ajax method for notify ...");h()}else{if(b.data.length>0){c("Using input data for notify ... ");f()}else{console.error("Ajax URL is not set!")}}}}(jQuery));